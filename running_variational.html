<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running variational algorithms &mdash; myQLM documentation  documentation</title>
      <link rel="stylesheet" href="static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="static/contentui.css" type="text/css" />
    <link rel="shortcut icon" href="static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="static/documentation_options.js"></script>
        <script src="static/jquery.js"></script>
        <script src="static/underscore.js"></script>
        <script src="static/doctools.js"></script>
        <script src="static/contentui.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Combinatorial optimization" href="combinatorial_optimization_intro.html" />
    <link rel="prev" title="Executing quantum circuits" href="simulating.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> myQLM documentation
            <img src="static/myqlm.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                myQLM-1.5.1-1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Basic usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="myqlm_specific/install.html">Installing myQLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="programming.html">Writing quantum circuits</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulating.html">Executing quantum circuits</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running variational algorithms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#variational-jobs">Variational jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#binding-variables">Binding variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Running variational algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#differentiating-jobs">Differentiating jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-for-several-initializations-of-the-parameters">Testing for several initializations of the parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="combinatorial_optimization_intro.html">Combinatorial optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="myqlm_specific/interoperability.html">Interoperability with myQLM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Main objects: Jobs, Observables, Circuits…</a></li>
<li class="toctree-l1"><a class="reference internal" href="manipulating.html">Building custom execution stacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_programming.html">Advanced programming using pyAQASM</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_combinatorial_optimization.html">Advanced combinatorial optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="aqasm.html">The AQASM format</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Command-line tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Source code documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="source_doc.html">Source code documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="myqlm_specific/support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="myqlm_specific/notebooks.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="myqlm_specific/contrib.html">Contributing to myQLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="myqlm_specific/release-note.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">myQLM documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Running variational algorithms</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="running-variational-algorithms">
<span id="variational"></span><h1>Running variational algorithms<a class="headerlink" href="#running-variational-algorithms" title="Permalink to this headline"></a></h1>
<p>QLM comes with a collection of tools to efficiently describe and run variational quantum algorithm.
This page introduces the basic mechanics allowing you to write and run adaptive variational schemes.</p>
<p>For a more advanced usage <a class="reference internal" href="combinatorial_optimization_intro.html#combinatorial-optimization"><span class="std std-ref">Combinatorial optimization</span></a> describes a high-level interface to described combinatorial optimization problems and automatically
generate parametrized Ansätze.</p>
<section id="variational-jobs">
<h2>Variational jobs<a class="headerlink" href="#variational-jobs" title="Permalink to this headline"></a></h2>
<p>When running a variational quantum algorithm, we are, most of the time, interested in minimizing the energy of some observable <span class="math notranslate nohighlight">\(H\)</span> over some
parametrized quantum state <span class="math notranslate nohighlight">\(|\psi(\theta)\rangle\)</span>, i.e minimizing <span class="math notranslate nohighlight">\(\langle \psi(\theta)| H |\psi(\theta) \rangle\)</span>.</p>
<p>In the QLM, it is possible to build a variational quantum circuit by introducing open parameters in a pyAQASM <cite>Program</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qat.lang.AQASM</span> <span class="kn">import</span> <span class="n">Program</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">RZ</span>

<span class="n">prog</span> <span class="o">=</span> <span class="n">Program</span><span class="p">()</span>
<span class="n">qbits</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">qalloc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">variable</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">new_var</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">RY</span><span class="p">(</span><span class="n">variable</span><span class="p">)(</span><span class="n">qbits</span><span class="p">)</span>
<span class="n">RZ</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">variable</span><span class="p">)(</span><span class="n">qbits</span><span class="p">)</span>

<span class="n">circuit</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">to_circ</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables:&quot;</span><span class="p">,</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_variables</span><span class="p">())</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">to_job</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Job variables:&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">get_variables</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Variables</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="n">Job</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Additionally, the sampled observable itself can have parametrized coefficients:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qat.core</span> <span class="kn">import</span> <span class="n">Observable</span><span class="p">,</span> <span class="n">Term</span><span class="p">,</span> <span class="n">Variable</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">Observable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Obs = \sum_i \sigma_x^i</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">obs</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">Observable</span><span class="o">.</span><span class="n">sigma_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Observable variables:&quot;</span><span class="p">,</span> <span class="n">obs</span><span class="o">.</span><span class="n">get_variables</span><span class="p">())</span>

<span class="kn">from</span> <span class="nn">qat.lang.AQASM</span> <span class="kn">import</span> <span class="n">Program</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">RZ</span>

<span class="n">prog</span> <span class="o">=</span> <span class="n">Program</span><span class="p">()</span>
<span class="n">qbits</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">qalloc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">variable</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">new_var</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">qbit</span> <span class="ow">in</span> <span class="n">qbits</span><span class="p">:</span>
    <span class="n">RY</span><span class="p">(</span><span class="n">variable</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
    <span class="n">RZ</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">variable</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>

<span class="n">circuit</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">to_circ</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit variables:&quot;</span><span class="p">,</span> <span class="n">circuit</span><span class="o">.</span><span class="n">get_variables</span><span class="p">())</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">to_job</span><span class="p">(</span><span class="n">observable</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Job variables:&quot;</span><span class="p">,</span> <span class="n">job</span><span class="o">.</span><span class="n">get_variables</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
<span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span>
<span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">Observable</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
<span class="n">Circuit</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="n">Job</span> <span class="n">variables</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This allows to have layered parametrized optimization, or even compilation tradeoffs where some variational parameters end up in the sampled observable.</p>
</section>
<section id="binding-variables">
<h2>Binding variables<a class="headerlink" href="#binding-variables" title="Permalink to this headline"></a></h2>
<p>Once we’ve built a parametrized job, its variables can be instantiated using the overloaded <cite>__call__</cite> operator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qat.lang.AQASM</span> <span class="kn">import</span> <span class="n">Program</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">RZ</span>
<span class="kn">from</span> <span class="nn">qat.core</span> <span class="kn">import</span> <span class="n">Observable</span><span class="p">,</span> <span class="n">Term</span><span class="p">,</span> <span class="n">Variable</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">Observable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">obs</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">Observable</span><span class="o">.</span><span class="n">sigma_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">prog</span> <span class="o">=</span> <span class="n">Program</span><span class="p">()</span>
<span class="n">qbits</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">qalloc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">variable</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">new_var</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">qbit</span> <span class="ow">in</span> <span class="n">qbits</span><span class="p">:</span>
    <span class="n">RY</span><span class="p">(</span><span class="n">variable</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
    <span class="n">RZ</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">variable</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">to_circ</span><span class="p">()</span><span class="o">.</span><span class="n">to_job</span><span class="p">(</span><span class="n">observable</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>

<span class="n">job_2</span> <span class="o">=</span> <span class="n">job</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">job_2</span><span class="o">.</span><span class="n">observable</span><span class="p">)</span>

<span class="n">job_3</span> <span class="o">=</span> <span class="n">job</span><span class="p">(</span><span class="o">**</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">job</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">job_3</span><span class="o">.</span><span class="n">observable</span><span class="p">)</span>
<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">job_3</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">iterate_simple</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
<span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span>
<span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="mf">0.707230409574273</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span>
<span class="mf">0.707230409574273</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span>
<span class="mf">0.707230409574273</span> <span class="o">*</span> <span class="p">(</span><span class="n">X</span><span class="o">|</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="p">(</span><span class="s1">&#39;RY&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.7665304401077588</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">(</span><span class="s1">&#39;RZ&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">3.0661217604310353</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">(</span><span class="s1">&#39;RY&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.7665304401077588</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">(</span><span class="s1">&#39;RZ&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">3.0661217604310353</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">(</span><span class="s1">&#39;RY&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.7665304401077588</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="p">(</span><span class="s1">&#39;RZ&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">3.0661217604310353</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When binding variables used inside a custom parametrized gate, a gate set containing the custom gate should be provided
via the <cite>gate_set</cite> kwargs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qat.lang.AQASM</span> <span class="kn">import</span> <span class="n">Program</span><span class="p">,</span> <span class="n">AbstractGate</span>

<span class="n">XX</span> <span class="o">=</span> <span class="n">AbstractGate</span><span class="p">(</span><span class="s2">&quot;XX&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">arity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">prog</span> <span class="o">=</span> <span class="n">Program</span><span class="p">()</span>
<span class="n">qbits</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">qalloc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">XX</span><span class="p">(</span><span class="n">prog</span><span class="o">.</span><span class="n">new_var</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">))(</span><span class="n">qbits</span><span class="p">)</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">to_circ</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">circuit_2</span> <span class="o">=</span> <span class="n">circuit</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Caught: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="n">circuit_2</span> <span class="o">=</span> <span class="n">circuit</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">gate_set</span><span class="o">=</span><span class="n">prog</span><span class="o">.</span><span class="n">gate_set</span><span class="p">)</span>
<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">circuit_2</span><span class="o">.</span><span class="n">iterate_simple</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;XX&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
<section id="id1">
<h2>Running variational algorithms<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<p>The simplest way to run a variational algorithm is to use a dedicated Plugin that will take care of the energy minimization.</p>
<p>The default variational Plugin wraps the <cite>scipy.optimize.minimize</cite> function: <a class="reference internal" href="variational-plugin.html#qat.plugins.ScipyMinimizePlugin" title="qat.plugins.ScipyMinimizePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">qat.plugins.ScipyMinimizePlugin</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qat.lang.AQASM</span> <span class="kn">import</span> <span class="n">Program</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">RZ</span>
<span class="kn">from</span> <span class="nn">qat.core</span> <span class="kn">import</span> <span class="n">Observable</span><span class="p">,</span> <span class="n">Term</span><span class="p">,</span> <span class="n">Variable</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">Observable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">obs</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">Observable</span><span class="o">.</span><span class="n">sigma_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">prog</span> <span class="o">=</span> <span class="n">Program</span><span class="p">()</span>
<span class="n">qbits</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">qalloc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">variable</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">new_var</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">qbit</span> <span class="ow">in</span> <span class="n">qbits</span><span class="p">:</span>
    <span class="n">RY</span><span class="p">(</span><span class="n">variable</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
    <span class="n">RZ</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">variable</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">to_circ</span><span class="p">()</span><span class="o">.</span><span class="n">to_job</span><span class="p">(</span><span class="n">observable</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">qat.plugins</span> <span class="kn">import</span> <span class="n">ScipyMinimizePlugin</span>

<span class="n">optimize</span> <span class="o">=</span> <span class="n">ScipyMinimizePlugin</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;COBYLA&quot;</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">})</span>

<span class="kn">from</span> <span class="nn">qat.qpus</span> <span class="kn">import</span> <span class="n">get_default_qpu</span>

<span class="n">stack</span> <span class="o">=</span> <span class="n">optimize</span> <span class="o">|</span> <span class="n">get_default_qpu</span><span class="p">()</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;final energy:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best parameters:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trace:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;optimization_trace&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">final</span> <span class="n">energy</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.866709359679454</span>
<span class="n">best</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8404552658244293</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9827544057629174</span><span class="p">]</span>
<span class="n">trace</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.792719164804098</span><span class="p">,</span> <span class="mf">1.4507025205812896</span><span class="p">,</span> <span class="mf">0.36105000157049766</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12182736415199133</span><span class="p">,</span> <span class="mf">0.02857034808036591</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2633764052096697</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.258054767179779</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6468060949481818</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6401714494050252</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.887823524295989</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0212175080949066</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.142859271943653</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2040417336754015</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.371793751166817</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.465590879639872</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.6099013208846316</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.748325377961648</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8846707144709804</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.020258367443034</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1568151390865142</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2928620133583766</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.4291916197854246</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5655471798935454</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7018638253652485</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.8381592257893455</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.974452437144903</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.110759231534164</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.247062769137771</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.382999215910916</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.519370496485264</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.65512542778959</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.791127507331291</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.926594858222932</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.054090526959829</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.17709452155187</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.303561537790375</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.407912309872126</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.066038929575061</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.47973626041298</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.560192083728539</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.464376903613459</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.6652723273267895</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.700597013041373</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7744531849664344</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.844754338257042</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.91322991009185</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.978593288054732</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.047332531419379</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.110991759288709</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.176697573649131</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.24127526576798</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.290519856308198</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3604428871926295</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.4030992036559935</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.474195801928539</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.520594171719192</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.594724033973681</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.645455814675827</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.719434477394022</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.777112984946399</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.849067815894115</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.913629037846459</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.982412461029416</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.051255576020742</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.119212817286489</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.187414269039579</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.255572939530791</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.323651897257685</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.391774910966143</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.459781035404502</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.526116543031048</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.5933624645518645</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.659081223981069</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.7064593382452955</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.776152629467855</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.810432620930224</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.88512913946807</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.911280915155744</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.993484345482937</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.021074626581992</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.104065174255933</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.141801778386743</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.221771302259478</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.269490938496926</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.346006449622363</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.401896682447001</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.475061410007006</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.537906141218155</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.607760942730017</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.676077204898439</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.743426418819231</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.811271625472974</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.878698851477928</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.941151643958793</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.00303338475238</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.062954937490321</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.086989606948547</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.173901614035357</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.160808076099437</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.179888938349889</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.222202233805255</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.252365919712254</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.285070292257952</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.31613583748128</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.334013284087908</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.375133334807273</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.39947985594043</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.435444958456804</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.469805234167346</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.503862923137277</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.537735096702862</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.571858221979676</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.605943953384548</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.639999562211734</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.674081761878256</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.708149357291118</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.74222621484597</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.776303088477265</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81037959446357</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.844455711606491</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.878530846981233</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.912597366107462</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.946674863714055</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.980752151188039</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.014827882790671</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.048903854421887</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.082979449276232</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.117055531078847</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.151131534127629</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.185207075216265</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.21928267788271</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.253358585771768</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.287434445159729</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.32151037376314</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.355586047534917</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.389649439469363</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.423728854367312</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.457796470971253</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.491874975521359</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.525948703706405</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.560024958791542</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.594101266769373</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.628177403951426</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.662253415465724</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.69632937350685</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.73040538592185</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.764481362094418</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.798557367203943</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.832633362361591</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.866709359679454</span><span class="p">]</span>
</pre></div>
</div>
<p>This plugin also supports a nice feature: it can read optimization parameters directly from the job’s meta data or directly from the result. This allows you to build a stack with no particular choice of optimization parameters and attach these parameters directly to the job when submitting it. In this setting, the previous example becomes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">qat.lang.AQASM</span> <span class="kn">import</span> <span class="n">Program</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">RZ</span>
<span class="kn">from</span> <span class="nn">qat.core</span> <span class="kn">import</span> <span class="n">Observable</span><span class="p">,</span> <span class="n">Term</span><span class="p">,</span> <span class="n">Variable</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">Observable</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">obs</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">Observable</span><span class="o">.</span><span class="n">sigma_x</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">prog</span> <span class="o">=</span> <span class="n">Program</span><span class="p">()</span>
<span class="n">qbits</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">qalloc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">variable</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">new_var</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">qbit</span> <span class="ow">in</span> <span class="n">qbits</span><span class="p">:</span>
    <span class="n">RY</span><span class="p">(</span><span class="n">variable</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
    <span class="n">RZ</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">variable</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">prog</span><span class="o">.</span><span class="n">to_circ</span><span class="p">()</span><span class="o">.</span><span class="n">to_job</span><span class="p">(</span><span class="n">observable</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">qat.plugins</span> <span class="kn">import</span> <span class="n">ScipyMinimizePlugin</span>

<span class="n">optimize</span> <span class="o">=</span> <span class="n">ScipyMinimizePlugin</span><span class="p">()</span>



<span class="kn">from</span> <span class="nn">qat.qpus</span> <span class="kn">import</span> <span class="n">get_default_qpu</span>

<span class="n">stack</span> <span class="o">=</span> <span class="n">optimize</span> <span class="o">|</span> <span class="n">get_default_qpu</span><span class="p">()</span>

<span class="n">optimizer_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;COBYLA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tol&quot;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
    <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ScipyMinimizePlugin&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">optimizer_args</span><span class="p">)})</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;final energy:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best parameters:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best parameters (dictionary):&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trace:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;optimization_trace&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">final</span> <span class="n">energy</span><span class="p">:</span> <span class="o">-</span><span class="mf">9.326367705734414</span>
<span class="n">best</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8404487005499227</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2764555749983435</span><span class="p">]</span>
<span class="n">best</span> <span class="n">parameters</span> <span class="p">(</span><span class="n">dictionary</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">0.8404487005499227</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.2764555749983435</span><span class="p">}</span>
<span class="n">trace</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1018171096919693</span><span class="p">,</span> <span class="mf">0.7159329398472147</span><span class="p">,</span> <span class="mf">0.28547025843428836</span><span class="p">,</span> <span class="mf">0.1590151651500477</span><span class="p">,</span> <span class="mf">0.01961273368052958</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6754116279397151</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3557285603287283</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9272109038670804</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5107741935516343</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4787555852644436</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6545386436175038</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9276326751382606</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.012617593437262</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1656643309803636</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.295252151018401</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.427651280615534</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.550753162318344</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.481370500402601</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.64560529266028</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5395523214501887</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7149790409426826</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7834648121085905</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8474710930931675</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.9160180454098272</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.9843622047722715</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.052598008824515</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.120774548153423</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1888891087170474</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.256667107025529</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3234371975181634</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3914185571447266</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.459370181195542</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.527228828430014</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5946595245081077</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6491035868421635</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7217192003031077</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.785956937532484</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.8539245390071812</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.921687326446297</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9890151638154494</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0539063868651875</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.122370989641496</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.186791733841528</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.251609848767452</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.318463355857993</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.3835574880288775</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.431608679154591</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5063844002957065</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.561084471283074</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.63207726174107</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.699452121475831</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.767439591499631</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.83498254531869</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.898325834642106</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.967019612349812</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0305732063419795</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.098479587512543</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.164083953715487</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.23269116599705</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.299030947428722</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.367653825232161</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.4349685958483205</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.503369806461905</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.57128106979548</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.639409246888963</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7075298186125</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.775627369181649</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.843582508412254</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.911457180118668</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.979229276978836</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0454221507454875</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.111862276096804</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.177668396702771</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.233958886266889</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300138541997059</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3516083399890135</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.268823360545618</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.402915397734031</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.455883799880231</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.467884023812669</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.568149235768772</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.592580229452204</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.673117365385788</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.738883481643198</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.806583347000008</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.8722894696391545</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9111364802415896</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.988925148886336</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.021625722740081</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.100678425391802</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.14585658435494</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.22252774549062</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.2787897238020935</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.351169371825428</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.417089744189328</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.484867313318722</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.552302900532096</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.617987713135395</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.598843872865723</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.645926336467047</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.517382597633005</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.6892735429955135</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.72501615043446</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.759128732343138</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.792928091412632</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.827070945183336</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.86109368925314</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.8951661682243905</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.929239633829487</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.963314266759783</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.997391020914141</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.031471628193726</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.065554872805738</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.09963339324081</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.133708985611126</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.167784726105747</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.201860761300345</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.23593676894802</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.270012759870049</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.304088664920789</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.338164129830371</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.372240135269642</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.406316181128545</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.440392232948764</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.474468256280424</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.50854425903895</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.542620254051101</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.576695769983111</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.61077191131302</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.64484778240605</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.678923778625657</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.712999781052936</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.747075788989905</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.78115179958801</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.815227806259754</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.84930380733411</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.883379805749776</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.917455764426423</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.951531766594425</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.98560775400462</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.019683756010382</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.053759752912978</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.087835749927585</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.121911749067896</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.155987726937074</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.190063732136013</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.224139724266195</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.258215724407062</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.292291723361416</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.326367705734414</span><span class="p">]</span>
</pre></div>
</div>
<p>An alternative is the <a class="reference internal" href="sequential_optimization.html#module-qat.plugins.sequential_optimization" title="qat.plugins.sequential_optimization"><code class="xref py py-class docutils literal notranslate"><span class="pre">qat.plugins.sequential_optimization</span></code></a> Plugin, which only works for a certain class of circuits but stands out for its shot-noise resilience.</p>
</section>
<section id="differentiating-jobs">
<h2>Differentiating jobs<a class="headerlink" href="#differentiating-jobs" title="Permalink to this headline"></a></h2>
<p>Many variational algorithms require computing the gradient of the cost function <span class="math notranslate nohighlight">\(E(\vec{\theta}) = \langle \psi(\vec{\theta}) | H | \psi(\vec{\theta})\rangle\)</span>.
The gradient can be used in gradient-based optimization methods.
QLM jobs come with methods to compute the derivative of <span class="math notranslate nohighlight">\(E(\vec{\theta})\)</span> automically: <a class="reference internal" href="qat-core.html#qat.core.Job.differentiate" title="qat.core.Job.differentiate"><code class="xref py py-func docutils literal notranslate"><span class="pre">differentiate()</span></code></a> and <a class="reference internal" href="qat-core.html#qat.core.Job.gradient" title="qat.core.Job.gradient"><code class="xref py py-func docutils literal notranslate"><span class="pre">gradient()</span></code></a>.</p>
<p>Examples of use of this feature are given in <a href="https://mybinder.org/v2/gh/myQLM/myqlm-notebooks/HEAD?filepath=tutorials%2Flang%2Fdifferentiating_jobs.ipynb" style="color: #ff7823; text-decoration: underline">this notebook</a>.</p>
</section>
<section id="testing-for-several-initializations-of-the-parameters">
<h2>Testing for several initializations of the parameters<a class="headerlink" href="#testing-for-several-initializations-of-the-parameters" title="Permalink to this headline"></a></h2>
<p>Variational optimization tends to be sensitive to the initial parameters it started from. You can insert the <a class="reference internal" href="multiple_launches_analyzer.html#module-qat.plugins.multiple_launches_analyzer" title="qat.plugins.multiple_launches_analyzer"><code class="xref py py-class docutils literal notranslate"><span class="pre">qat.plugins.multiple_launches_analyzer</span></code></a> Plugin before a VQE optimizer to automatically perform several VQE runs and keep the lowest-energy result. This is illustrated in the notebook <span style="color: red">NOTEBOOK LINK ERROR</span>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="simulating.html" class="btn btn-neutral float-left" title="Executing quantum circuits" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="combinatorial_optimization_intro.html" class="btn btn-neutral float-right" title="Combinatorial optimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Atos 2016-2022.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>