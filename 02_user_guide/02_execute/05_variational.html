<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running variational algorithms &mdash; myQLM documentation  documentation</title>
      <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
    <link rel="shortcut icon" href="../../static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../static/documentation_options.js"></script>
        <script src="../../static/jquery.js"></script>
        <script src="../../static/underscore.js"></script>
        <script src="../../static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../static/doctools.js"></script>
        <script src="../../static/sphinx_highlight.js"></script>
        <script src="../../static/design-tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Spin and fermionic systems" href="../../fermion.html" />
    <link rel="prev" title="Getting information from the QPU" href="04_plugin/03_hardware_specs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> myQLM documentation
            <img src="../../static/myqlm-doc-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                myQLM-1.9.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../01_getting_started.html">Getting started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../02_user_guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_write.html">Writing quantum programs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../02_execute.html">Executing / Simulating quantum programs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_job.html">Constructing one or multiple Jobs (using Batch)</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_result.html">Result of a quantum program</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_qpu.html">Quantum Processing Unit (QPU)</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_plugin.html">Extending a QPU (by using Plugins)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Running variational algorithms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#extending-a-qpu-to-support-variational-jobs">Extending a QPU to support variational jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#differentiating-jobs">Differentiating jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-for-several-initializations-of-the-parameters">Testing for several initializations of the parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../02_user_guide.html#libraries-built-upon-qaptiva">Libraries built upon Qaptiva</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../04_api_reference.html">API reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../05_demos.html">Demos</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../%3Amyqlm%3A06_support.html">Contributing to myQLM</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../07_release_notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">myQLM documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../02_user_guide.html">User guide</a> &raquo;</li>
          <li><a href="../02_execute.html">Executing / Simulating quantum programs</a> &raquo;</li>
      <li>Running variational algorithms</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-variational-algorithms">
<span id="running-variational"></span><h1>Running variational algorithms<a class="headerlink" href="#running-variational-algorithms" title="Permalink to this heading"></a></h1>
<p>This framework comes with a collection of tools to efficiently describe and run variational quantum algorithm.
This page introduces the basic mechanics allowing you to write variational schemes.</p>
<p>Writing <a class="reference internal" href="../01_write/01_digital_circuit/02_variational.html#gate-based-variational"><span class="std std-ref">variational circuits</span></a> is discussed in another section.</p>
<section id="extending-a-qpu-to-support-variational-jobs">
<h2>Extending a QPU to support variational jobs<a class="headerlink" href="#extending-a-qpu-to-support-variational-jobs" title="Permalink to this heading"></a></h2>
<p>The simplest way to run a variational algorithm is to use a <a class="reference internal" href="04_plugin.html#plugin"><span class="std std-ref">dedicated Plugin</span></a> that will take care of the energy
minimization.</p>
<p>The default variational Plugin wraps the <cite>scipy.optimize.minimize</cite> function: <a class="reference internal" href="../../04_api_reference/module_qat/module_plugins/scipyminimizeplugin.html#qat.plugins.ScipyMinimizePlugin" title="qat.plugins.ScipyMinimizePlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScipyMinimizePlugin</span></code></a>. This plugin
extends an exisiting QPU by using the “|” operator</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qat.plugins</span> <span class="kn">import</span> <span class="n">ScipyMinimizePlugin</span>
<span class="kn">from</span> <span class="nn">qat.qpus</span> <span class="kn">import</span> <span class="n">get_default_qpu</span>

<span class="n">qpu</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ScipyMinimizePlugin</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;COBYLA&quot;</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">})</span>
    <span class="o">|</span> <span class="n">get_default_qpu</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This new QPU will optimize the abstract variable parametrizing the submitted job, to minimize the measured average value of the
<a class="reference internal" href="../01_write/03_observable.html#observable"><span class="std std-ref">observable</span></a> attached to the job.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qat.lang</span> <span class="kn">import</span> <span class="n">qrout</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">RZ</span>
<span class="kn">from</span> <span class="nn">qat.core</span> <span class="kn">import</span> <span class="n">Observable</span><span class="p">,</span> <span class="n">Term</span><span class="p">,</span> <span class="n">Variable</span>

<span class="c1"># Define the observable</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">Observable</span><span class="o">.</span><span class="n">sigma_x</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># Define the Ansatz</span>
<span class="nd">@qrout</span>
<span class="k">def</span> <span class="nf">ansatz</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="s2">&quot; Dummy Ansatz&quot;</span>
    <span class="k">for</span> <span class="n">qbit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">RY</span><span class="p">(</span><span class="n">theta</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
        <span class="n">RZ</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>

<span class="c1"># Define job and submit it</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">ansatz</span><span class="o">.</span><span class="n">to_job</span><span class="p">(</span><span class="n">observable</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">qpu</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;final energy:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best parameters:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trace:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;optimization_trace&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">final</span> <span class="n">energy</span><span class="p">:</span> <span class="o">-</span><span class="mf">16.72589087739728</span>
<span class="n">best</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mf">6.575296961085847</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="mf">1.5708027470812536</span><span class="p">}</span>
<span class="n">trace</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.02924376556321557</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3491693353937862</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9413371708419156</span><span class="p">,</span> <span class="mf">2.100304531649883</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6373547501208282</span><span class="p">,</span> <span class="mf">1.422705905945226</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8095542422041744</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1272121712565313</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.104546660154741</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.9200736118036703</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.829353201643059</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325684269407976</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2954649137061933</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.499465582603072</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.64256139049518</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6671617906214236</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9455244892374197</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.064948547079913</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.257816240062744</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.444207398060422</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.620401544730177</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.712737283243093</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.94209149298356</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.020085151794458</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.241074738365559</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.385838817296767</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.588530635739636</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.766906589841837</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.953434666713543</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.140022984525743</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3266903602418605</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.51363689963926</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.702052494197259</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.894208718745421</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.075019458855983</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.265288913153251</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4510690761902385</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.639028765797423</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.826951008684026</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.01432719474426</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.201836470434067</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.389173042127036</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.576658606089147</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.764177289333961</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.951233377567647</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.136208213924263</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.325029829809734</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.50490196367635</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.69262190743311</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.86444551227045</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.016008053181771</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.201599538961855</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.404598839060547</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.589922929224063</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.769595574153936</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.907015531487467</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.120989179792586</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.28786880544026</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.487145529036667</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.665450076927849</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.858790086052256</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.03717240611736</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.228390737551468</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.390612298290339</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.542960119778503</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.706432668081177</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.833280900325715</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.10261187993202</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.916496567126117</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.932274076163935</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.570695248388866</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.115371367541279</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.11565588654382</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.182281515412688</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.240317073054849</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.290482805591463</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.337539128169055</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.384051909020034</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.430971664816377</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.477689867111849</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.52460832437291</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.571454872899578</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.61832681624071</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.665196336127362</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.712058377663364</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.758831474159322</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.805718677007254</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.852493429553352</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.899339714109619</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.94616789756217</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.992790195558065</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.03956553886819</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.08622528476418</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.13177027104782</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.178370042339964</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.224146551868909</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.269879131106894</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.316090342308424</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.361105441125098</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.380817876632868</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.437769782625008</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.474190337155404</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.522334945435905</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.570215083681571</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.617556777551208</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.664541837816373</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.711113459290692</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.758091112140388</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.80459779372329</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.851452986299968</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.89816816010188</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.945087269120293</span><span class="p">,</span> <span class="o">-</span><span class="mf">14.991860546107489</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.038764241558804</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.085620494432682</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.132495302073677</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.179369918179564</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.226244232329709</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.273117729585586</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.319987046367206</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.366633564966683</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.413574329467167</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.460278465196216</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.507201246299733</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.554034377314169</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.600916234115578</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.647796464518773</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.694671867854224</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.741546840486961</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.788418456150561</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.835291899959795</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.882166609308129</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.929039476944626</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.975914857469217</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.02278968701722</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.069645931635016</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.11652682208794</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.163389408084406</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.2102681525037</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.25714011844821</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.304015158976885</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.35089031301427</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.397765567725482</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.444640858578303</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.491516040508444</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.538391087720683</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.5852659892807</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.632141015197263</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.679015891066552</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.72589087739728</span><span class="p">]</span>
</pre></div>
</div>
<p>This plugin also supports a nice feature: it can read optimization parameters directly from the job’s meta data or directly from the
result. This allows you to build a stack with no particular choice of optimization parameters and attach these parameters
directly to the job when submitting it. In this setting, the previous example becomes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">qat.plugins</span> <span class="kn">import</span> <span class="n">ScipyMinimizePlugin</span>
<span class="kn">from</span> <span class="nn">qat.qpus</span> <span class="kn">import</span> <span class="n">get_default_qpu</span>

<span class="n">qpu</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ScipyMinimizePlugin</span><span class="p">()</span>
    <span class="o">|</span> <span class="n">get_default_qpu</span><span class="p">()</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">qat.lang</span> <span class="kn">import</span> <span class="n">qrout</span><span class="p">,</span> <span class="n">RY</span><span class="p">,</span> <span class="n">RZ</span>
<span class="kn">from</span> <span class="nn">qat.core</span> <span class="kn">import</span> <span class="n">Observable</span><span class="p">,</span> <span class="n">Term</span><span class="p">,</span> <span class="n">Variable</span>

<span class="c1"># Define the observable</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">Observable</span><span class="o">.</span><span class="n">sigma_x</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># Define the Ansatz</span>
<span class="nd">@qrout</span>
<span class="k">def</span> <span class="nf">ansatz</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="s2">&quot; Dummy Ansatz&quot;</span>
    <span class="k">for</span> <span class="n">qbit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">RY</span><span class="p">(</span><span class="n">theta</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>
        <span class="n">RZ</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)(</span><span class="n">qbit</span><span class="p">)</span>

<span class="c1"># Define job and submit it</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">ansatz</span><span class="o">.</span><span class="n">to_job</span><span class="p">(</span><span class="n">observable</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>

<span class="n">optimizer_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;COBYLA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tol&quot;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
    <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">}</span>
<span class="p">}</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">qpu</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ScipyMinimizePlugin&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">optimizer_args</span><span class="p">)})</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;final energy:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best parameters:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trace:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;optimization_trace&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">final</span> <span class="n">energy</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.667163473929715</span>
<span class="n">best</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.891255855827062</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span> <span class="mf">0.8404636211440816</span><span class="p">}</span>
<span class="n">trace</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.9672725688106613</span><span class="p">,</span> <span class="mf">0.8796771282940263</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.019448939296185363</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9385069543121394</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.921948594801894</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7568089489747964</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5995637499635402</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.356516433994087</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6324289890757493</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.282755369471255</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.92394041102167</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.532917597194872</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2859231540845113</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.6148557127756575</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4180729304333486</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.756205864161254</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.892541256349063</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0135213967390304</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.154708690909439</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.282784863316425</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.4218965908753023</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.556425215649207</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6925042760935662</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.8285150217681894</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9642567641159028</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.097532009798977</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.132241501492708</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.306501743464924</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.419548825213264</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.561705600961724</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.702297163556809</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.835105015466259</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.972323315687793</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.104143328272829</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.2397543090092045</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.367330165870264</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.474527802757124</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.614855666479836</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.761525505352642</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.890399437471735</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.030525138109079</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.162455788590421</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300910677071636</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.430203069833324</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.566918833791105</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.686648411923003</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.789975817302542</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9194488561434655</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0628694161245225</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.21751624135636</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.313711976304814</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.453907706321818</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.483669425476339</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.6380372763756625</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.436210938653366</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.57939497322567</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.68003394134689</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.665757340626822</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.70287048574387</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.741500778372524</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.77087567545694</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.805356232156951</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.839553908622863</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.873531319240147</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.906998534333179</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.931908098924529</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.969138866118115</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.999717960632204</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.03409156187633</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.06838202903636</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.102586439774097</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.136708611084194</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.170709329635528</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.203896930650785</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.236009467319796</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.26945610096394</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.302273613700926</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.330941996919464</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.35677151979542</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.386274931018518</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.407466415791367</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.357075405232848</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.444085867955696</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.469467847630357</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.431663009115585</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.501096428229106</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.533314362708882</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.559758501235414</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.594742326433275</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.623395391460813</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.658069681630655</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.69084965138333</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.725235968112461</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.759325763475996</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.793297599702951</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.827405734976033</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.861445366891202</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.895522107208217</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.929598558639272</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.963674010275135</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.997743199772653</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.031819299482875</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.065881384535055</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.099790114023858</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.133879473666028</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.167852366248795</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.201948274886522</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.235985409051896</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.270071307200963</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.304142475106376</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.338215526743952</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.372291856042924</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.406365284890976</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.440442050516808</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.474517175767936</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.50859331008917</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.542669127961233</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.576745035043547</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.610820710578412</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.644896699133907</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.678972675289831</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.713048626110195</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.747124457470331</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.781190576861237</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.815269604869595</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.84933996702908</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.883417437584006</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.917492893470305</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.951568604029516</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.985644663209374</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.019720362826673</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.053796353818331</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.087872276480912</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.121948282286596</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.156024262119088</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.190099461417052</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.224175684291964</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.258251638828469</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.292327565712636</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.326403585799557</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.360479523203137</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.39455553923552</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.428631519612397</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.462707522994371</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.496783516073096</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.530859515315207</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.56493551069478</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.599011460974777</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.633087468646856</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.667163473929715</span><span class="p">]</span>
</pre></div>
</div>
<p>An alternative is the <a class="reference internal" href="../../04_api_reference/module_qat/module_plugins/seqoptim.html#qat.plugins.SeqOptim" title="qat.plugins.SeqOptim"><code class="xref py py-class docutils literal notranslate"><span class="pre">SeqOptim</span></code></a> Plugin, which only works for a certain class of circuits but stands out for its
shot-noise resilience.</p>
</section>
<section id="differentiating-jobs">
<h2>Differentiating jobs<a class="headerlink" href="#differentiating-jobs" title="Permalink to this heading"></a></h2>
<p>Many variational algorithms require computing the gradient of the cost function <span class="math notranslate nohighlight">\(E(\vec{\theta}) = \langle \psi(\vec{\theta}) | H | \psi(\vec{\theta})\rangle\)</span>.
The gradient can be used in gradient-based optimization methods.
Qaptiva jobs come with methods to compute the derivative of <span class="math notranslate nohighlight">\(E(\vec{\theta})\)</span> automically: <a class="reference internal" href="../../04_api_reference/module_qat/module_core/job.html#qat.core.Job.differentiate" title="qat.core.Job.differentiate"><code class="xref py py-func docutils literal notranslate"><span class="pre">differentiate()</span></code></a> and <a class="reference internal" href="../../04_api_reference/module_qat/module_core/job.html#qat.core.Job.gradient" title="qat.core.Job.gradient"><code class="xref py py-func docutils literal notranslate"><span class="pre">gradient()</span></code></a>.</p>
<p>Examples of use of this feature are given in <a href="https://mybinder.org/v2/gh/myQLM/myqlm-notebooks/HEAD?filepath=tutorials%2Flang%2Fdifferentiating_jobs.ipynb" style="color: #ff7823; text-decoration: underline; cursor: pointer">the "differentiating jobs" notebook</a>.</p>
</section>
<section id="testing-for-several-initializations-of-the-parameters">
<h2>Testing for several initializations of the parameters<a class="headerlink" href="#testing-for-several-initializations-of-the-parameters" title="Permalink to this heading"></a></h2>
<p>Variational optimization tends to be sensitive to the initial parameters it started from. You can insert the
<a class="reference internal" href="../../04_api_reference/module_qat/module_plugins/multiplelaunchesanalyzer.html#qat.plugins.MultipleLaunchesAnalyzer" title="qat.plugins.MultipleLaunchesAnalyzer"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleLaunchesAnalyzer</span></code></a> Plugin before a VQE optimizer to automatically perform several VQE
runs and keep the lowest-energy result. This is illustrated in the notebook
<a href="https://mybinder.org/v2/gh/myQLM/myqlm-notebooks/HEAD?filepath=tutorials%2Fdigital_quantum_simulations_spin_fermion%2Fqat_fermion_multiple_launches_analyzer_plugin.ipynb" style="color: #ff7823; text-decoration: underline; cursor: pointer">Making several VQE runs and keeping the best result with the MultipleLaunchesAnalyzer plugin</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="04_plugin/03_hardware_specs.html" class="btn btn-neutral float-left" title="Getting information from the QPU" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../fermion.html" class="btn btn-neutral float-right" title="Spin and fermionic systems" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Eviden 2016-2023.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>